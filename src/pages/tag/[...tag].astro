---
import { pageWiseMeta } from '@lib/config';
import { getCollection } from 'astro:content';
import {
  capitalizeSentence,
  getAllTagsMap,
  getPublishedAndSortedPosts,
  slugifyTag,
  unSlugifyTag,
} from '@lib/utils';
import SimpleLayout from '@layouts/SimpleLayout.astro';
import SearchList from '@components/SearchList';
import FilterByTagsCard from '@components/ui/FilterByTagsCard.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tagsMap = getAllTagsMap(posts);
  const allTags = Object.keys(tagsMap).map(slugifyTag);
  return allTags.map((tag) => ({
    params: { tag },
  }));
}

const { tag } = Astro.params;
const unSlugifiedTag = unSlugifyTag(tag || '');
const tagName = capitalizeSentence(unSlugifiedTag);
const posts = getPublishedAndSortedPosts(await getCollection('blog'));
const tagsMap = getAllTagsMap(posts);
const allTags = Object.keys(tagsMap);
const postsByTag = posts.filter((post) =>
  post.data.tags.includes(unSlugifiedTag),
);

const { title, description } = pageWiseMeta.tag;
---

<SimpleLayout title={`${tagName} | ${title}`} description={description}>
  <div slot='header-main-section'>
    <h1
      class='text-4xl font-bold tracking-tight text-zinc-800 dark:text-zinc-100 sm:text-5xl'
    >
      Tagged Brilliance: Unveiling <span
        class='font-semibold underline decoration-wavy'>{tagName}</span
      > Wonders
    </h1>
    <p class='mt-6 text-base text-zinc-600 dark:text-zinc-400'>
      Delve into a collection of blogs focused on ${tagName}, exploring the
      depths of knowledge and expertise. There are total {postsByTag.length} blogs
      on this subject.
    </p>
  </div>
  <div slot='header-side-section'>
    <FilterByTagsCard tagsList={allTags} selectedTag={unSlugifiedTag} />
  </div>
  <SearchList searchList={postsByTag} client:load />
</SimpleLayout>
